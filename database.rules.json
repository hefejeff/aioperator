{
  "rules": {
    ".read": "auth != null",
    "users": {
      ".indexOn": ["email"],
      "$uid": {
        ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')"
      }
    },
    "evaluations": {
      "$uid": {
        ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')",
        ".indexOn": ["scenarioId"]
      }
    },
    "workflowVersions": {
      ".indexOn": ["id"],
      "$uid": {
        ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')",
        "$scenarioId": {
          ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')",
          ".indexOn": ["timestamp"]
        }
      }
    },
    "userScenarioOverrides": {
      "$uid": {
        ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')"
      }
    },
    "scenarios": {
      ".indexOn": ["userId", "type"],
      "$scenarioId": {
        ".write": "auth != null && (auth.uid === data.child('userId').val() || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')",
        "favoritedBy": {
          ".indexOn": ["userId"],
          "$userId": {
            ".write": "auth != null && (auth.uid === $userId || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')"
          }
        }
      }
    },
    "leaderboards": {
      "$scenarioId": {
        ".indexOn": "score",
        "$uid": {
          ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')"
        }
      }
    },
    "prds": {
      "$uid": {
        ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')",
        ".indexOn": ["scenarioId", "timestamp", "platform"]
      }
    },
    "pitches": {
      "$uid": {
        ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')",
        ".indexOn": ["scenarioId", "timestamp"]
      }
    },

    "companies": {
      ".indexOn": ["createdBy", "name"],
      "$companyId": {
        ".write": "auth != null && (!data.exists() || auth.uid === data.child('createdBy').val())",
        "selectedScenarios": {
          ".write": "auth != null && auth.uid === root.child('companies').child($companyId).child('createdBy').val()"
        }
      }
    },
    
    "presentations": {
      ".indexOn": ["userId", "companyId", "createdAt"],
      "$generationId": {
        ".write": "auth != null && (!data.exists() || auth.uid === data.child('userId').val() || root.child('users').child(auth.uid).child('role').val() === 'SUPER_ADMIN' || root.child('users').child(auth.uid).child('role').val() === 'ADMIN')"
      }
    }
  }
}